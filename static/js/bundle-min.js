function mainFunc(){var e=new App;e.init()}var App=function(){this.counter=0,this.init=function(){var e=this;this.addRow(!1),$("#add-task-button").on("click",function(){e.addRow(!0)}),$("#show-timeline-button").on("click",function(){e.post()}),$("#color-picker-border-1,#color-picker-fill-1").colorpicker({format:"hex"}),$("#color-picker-border-2,#color-picker-fill-2").colorpicker({format:"hex"}),$("#color-picker-frame-border,#color-picker-frame-fill").colorpicker({format:"hex"}),$("#color-picker-stripe-dark,#color-picker-stripe-light,#color-picker-grid").colorpicker({format:"hex"}),$("#datepicker-end").datepicker({format:"yyyy-mm-dd"}),$("#source-div").css({display:"none"}),$("#modal-action-button").on("click",function(){e.import()}),this.addTableButtonHandlers(),this.clipboard=new Clipboard("#copy-button"),this.clipboard.on("error",function(e){}),$("#import-modal").on("shown.bs.modal",function(){$("#modal-source").focus()})},this.addTableButtonHandlers=function(){for(var e=this,t=["up-button","down-button","delete-button"],o=0;o<t.length;o++)$("."+t[o]).unbind("click");$(".up-button").on("click",function(){e.up(this.id)}),$(".down-button").on("click",function(){e.down(this.id)}),$(".delete-button").on("click",function(){e.delete(this.id)}),$(".ongoing-checkbox").on("click",function(){e.toggleOngoing(this.id)})},this.addRow=function(e){return this.counter++,$("#task-table-body").append('<tr class="task" id="task-'+this.counter+'"><td><div class="input-append date"><input class="form-control" id="datepicker-start-'+this.counter+'" size="16" type="text" readonly><span class="add-on"><i class="icon-th"></i></span></div></td><td><div class="input-append date"><input class="form-control" id="datepicker-end-'+this.counter+'" size="16" type="text" readonly><span class="add-on"><i class="icon-th"></i></span></td><td><div class="checkbox"><label><input class="ongoing-checkbox" id="datepicker-end-'+this.counter+'-ongoing" type="checkbox">&nbsp;Ongoing</label></div></td><td><input class="form-control" id="label-'+this.counter+'" type="text"></td><td><input class="form-control" id="milestones-'+this.counter+'" type="text" placeholder="2001-01-01, ..."></td><td><input class="form-control" id="dateStamps-'+this.counter+'" type="text" placeholder="2001-01-01, ..."></td><td><input class="form-control" id="startTo-'+this.counter+'" type="text" placeholder="1, 2"></td><td><input class="form-control" id="endTo-'+this.counter+'" type="text" placeholder="3, 4"></td><td><input class="form-control" id="recur-'+this.counter+'" type="text" placeholder="7"></td><td><button class="up-button btn btn-default" id="up-button-'+this.counter+'">&uarr;</button></td><td><button class="down-button btn btn-default" id="down-button-'+this.counter+'">&darr;</button></td><td><button class="delete-button btn btn-default" id="delete-button-'+this.counter+'">&cross;</button></td></tr>'),$("#datepicker-start-"+this.counter+",#datepicker-end-"+this.counter).datepicker({format:"yyyy-mm-dd"}),e&&$("#datepicker-start-"+this.counter).focus(),this.addTableButtonHandlers(),this.counter},this.serialize=function(){for(var e={settings:{},tasks:[],theme:{frameBorderColor:"#ffffff",frameFillColor:"#888888",stripeColorDark:"#dddddd",stripeColorLight:"#eeeeee",gridColor:"#999999"}},t=$(".task"),o=0;o<t.length;o++){var r=t[o],i=r.id,c=i.replace(/^task-/,""),l=$("#datepicker-start-"+c).datepicker("getFormattedDate"),n=$("#datepicker-end-"+c).datepicker("getFormattedDate"),a=$("#datepicker-end-"+c+"-ongoing").prop("checked");a&&(n="-");var d=$("#label-"+c).val(),s={};s.start=l,s.label=d,n.length>0&&(s.end=n),e.tasks.push(s)}e.settings.end=$("#datepicker-end").datepicker("getFormattedDate");var p=$("#datepicker-end-ongoing").prop("checked");p&&(e.settings.end="-");var u=Number($("#zoom-input").val());e.settings.zoom=u>=50&&u<=300?u:150;var f=Number($("#hide-days-from-input").val());e.settings.hideDaysFrom=f>=1&&f<=365?hideDaysFroVal:90;var k=Number($("#hide-weeks-from-input").val());e.settings.hideWeeksFrom=k>=1&&k<=1460?k:180;var h=$("#color-scheme-select").val();return e.theme.colorScheme=h.length>0?h:"gradient",e.theme.borderColor1=$("#color-picker-border-1").colorpicker("getValue","#ffffff"),e.theme.fillColor1=$("#color-picker-fill-1").colorpicker("getValue","#ffffff"),e.theme.borderColor2=$("#color-picker-border-2").colorpicker("getValue","#ffffff"),e.theme.fillColor2=$("#color-picker-fill-2").colorpicker("getValue","#ffffff"),e.theme.frameBorderColor=$("#color-picker-frame-border").colorpicker("getValue","#ffffff"),e.theme.frameFillColor=$("#color-picker-frame-fill").colorpicker("getValue","#ffffff"),e.theme.stripeColorDark=$("#color-picker-stripe-dark").colorpicker("getValue","#ffffff"),e.theme.stripeColorLight=$("#color-picker-stripe-light").colorpicker("getValue","#ffffff"),e.theme.stripeGridColor=$("#color-picker-grid").colorpicker("getValue","#ffffff"),JSON.stringify(e)},this.post=function(){var e=this.serialize();$.post("/timeline",e,function(t){return $("#result").html(t),0===e.length?void $("#source-div").css({display:"none"}):($("#source-div").css({display:"block"}),void($("#source")[0].value=e))})},this.up=function(e){var t=e.replace(/^up-button/,"#task");$(t).prev().before($(t)),this.addTableButtonHandlers()},this.down=function(e){var t=e.replace(/^down-button/,"#task");$(t).next().after($(t)),this.addTableButtonHandlers()},this.delete=function(e){var t=e.replace(/^delete-button/,"#task");$(t).remove(),this.addTableButtonHandlers()},this.toggleOngoing=function(e){var t=e.replace(/-ongoing$/,"");$("#"+e).prop("checked")===!1&&$("#"+t).datepicker("update","")},this.import=function(){var e=$("#modal-source")[0].value;try{var t=JSON.parse(e)}catch(e){return void($("#result")[0].innerHTML=e.message)}if(t!=={}&&null!==t&&"undefined"!=typeof t||($("#result")[0].innerHTML="No timeline data found"),this.clearTasks(),t.tasks)for(var o=0;o<t.tasks.length;o++){var r=t.tasks[o],i=this.addRow(!1);$("#datepicker-start-"+i).datepicker("update",r.start);var c="-"===r.end;$("#datepicker-end-"+i).datepicker("update",c?"":r.end),$("#datepicker-end-"+i+"-ongoing").prop("checked",c),$("#label-"+i).val(r.label)}if(t.settings){var l=t.settings,c="-"===l.end;$("#datepicker-end").datepicker("update",c?"":l.end),$("#datepicker-end-ongoing").prop("checked",c),$("#zoom-input").val(l.zoom),$("#hide-days-from-input").val(l.hideDaysFrom),$("#hide-weeks-from-input").val(l.hideWeeksFrom)}if(t.theme){var n=t.theme;$("#color-scheme-select").val(n.colorScheme),$("#color-picker-border-1").colorpicker("setValue",n.borderColor1),$("#color-picker-fill-1").colorpicker("setValue",n.fillColor1),$("#color-picker-border-2").colorpicker("setValue",n.borderColor2),$("#color-picker-fill-2").colorpicker("setValue",n.fillColor2),$("#color-picker-frame-border").colorpicker("setValue",n.frameBorderColor),$("#color-picker-frame-fill").colorpicker("setValue",n.frameFillColor),$("#color-picker-stripe-dark").colorpicker("setValue",n.stripeColorDark),$("#color-picker-stripe-light").colorpicker("setValue",n.stripeColorLight),$("#color-picker-grid").colorpicker("setValue",n.gridColor)}},this.clearTasks=function(){$("#task-table-body")[0].innerHTML=""}};window.onload=mainFunc;